"""
–ó–∞–≤–¥–∞–Ω–Ω—è 3: –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –ø–æ—à—É–∫—É –ø—ñ–¥—Ä—è–¥–∫–∞

–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤:
- –ë–æ—î—Ä–∞-–ú—É—Ä–∞ (Boyer-Moore)
- –ö–Ω—É—Ç–∞-–ú–æ—Ä—Ä—ñ—Å–∞-–ü—Ä–∞—Ç—Ç–∞ (Knuth-Morris-Pratt)
- –†–∞–±—ñ–Ω–∞-–ö–∞—Ä–ø–∞ (Rabin-Karp)
"""

import timeit
import hashlib


def boyer_moore_search(text, pattern):
    """
    –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—à—É–∫—É –ø—ñ–¥—Ä—è–¥–∫–∞ –ë–æ—î—Ä–∞-–ú—É—Ä–∞.
    
    Args:
        text (str): –¢–µ–∫—Å—Ç –¥–ª—è –ø–æ—à—É–∫—É
        pattern (str): –ü—ñ–¥—Ä—è–¥–æ–∫ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è
        
    Returns:
        list: –°–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü—ñ–π, –¥–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø—ñ–¥—Ä—è–¥–æ–∫
    """
    def build_bad_char_table(pattern):
        """–ë—É–¥—É—î —Ç–∞–±–ª–∏—Ü—é –∑—Å—É–≤—ñ–≤ –¥–ª—è –ø–æ–≥–∞–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤."""
        table = {}
        for i in range(len(pattern)):
            table[pattern[i]] = i
        return table
    
    if not pattern:
        return []
    
    bad_char_table = build_bad_char_table(pattern)
    positions = []
    i = 0
    
    while i <= len(text) - len(pattern):
        j = len(pattern) - 1
        
        # –ü–æ—Ä—ñ–≤–Ω—é—î–º–æ –∑ –∫—ñ–Ω—Ü—è —à–∞–±–ª–æ–Ω—É
        while j >= 0 and pattern[j] == text[i + j]:
            j -= 1
        
        if j < 0:
            # –ó–Ω–∞–π–¥–µ–Ω–æ –∑–±—ñ–≥
            positions.append(i)
            i += 1
        else:
            # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–∞–≤–∏–ª–æ –ø–æ–≥–∞–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
            bad_char = text[i + j]
            if bad_char in bad_char_table:
                i += max(1, j - bad_char_table[bad_char])
            else:
                i += j + 1
    
    return positions


def kmp_search(text, pattern):
    """
    –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—à—É–∫—É –ø—ñ–¥—Ä—è–¥–∫–∞ –ö–Ω—É—Ç–∞-–ú–æ—Ä—Ä—ñ—Å–∞-–ü—Ä–∞—Ç—Ç–∞.
    
    Args:
        text (str): –¢–µ–∫—Å—Ç –¥–ª—è –ø–æ—à—É–∫—É
        pattern (str): –ü—ñ–¥—Ä—è–¥–æ–∫ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è
        
    Returns:
        list: –°–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü—ñ–π, –¥–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø—ñ–¥—Ä—è–¥–æ–∫
    """
    def build_lps_array(pattern):
        """–ë—É–¥—É—î –º–∞—Å–∏–≤ –Ω–∞–π–¥–æ–≤—à–∏—Ö –ø—Ä–µ—Ñ—ñ–∫—Å—ñ–≤-—Å—É—Ñ—ñ–∫—Å—ñ–≤."""
        lps = [0] * len(pattern)
        length = 0
        i = 1
        
        while i < len(pattern):
            if pattern[i] == pattern[length]:
                length += 1
                lps[i] = length
                i += 1
            else:
                if length != 0:
                    length = lps[length - 1]
                else:
                    lps[i] = 0
                    i += 1
        return lps
    
    if not pattern:
        return []
    
    lps = build_lps_array(pattern)
    positions = []
    i = 0  # —ñ–Ω–¥–µ–∫—Å –¥–ª—è —Ç–µ–∫—Å—Ç—É
    j = 0  # —ñ–Ω–¥–µ–∫—Å –¥–ª—è —à–∞–±–ª–æ–Ω—É
    
    while i < len(text):
        if pattern[j] == text[i]:
            i += 1
            j += 1
        
        if j == len(pattern):
            positions.append(i - j)
            j = lps[j - 1]
        elif i < len(text) and pattern[j] != text[i]:
            if j != 0:
                j = lps[j - 1]
            else:
                i += 1
    
    return positions


def rabin_karp_search(text, pattern):
    """
    –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—à—É–∫—É –ø—ñ–¥—Ä—è–¥–∫–∞ –†–∞–±—ñ–Ω–∞-–ö–∞—Ä–ø–∞.
    
    Args:
        text (str): –¢–µ–∫—Å—Ç –¥–ª—è –ø–æ—à—É–∫—É
        pattern (str): –ü—ñ–¥—Ä—è–¥–æ–∫ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è
        
    Returns:
        list: –°–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü—ñ–π, –¥–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø—ñ–¥—Ä—è–¥–æ–∫
    """
    if not pattern:
        return []
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è —Ö–µ—à—É–≤–∞–Ω–Ω—è
    d = 256  # –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–∏–º–≤–æ–ª—ñ–≤ –≤ –∞–ª—Ñ–∞–≤—ñ—Ç—ñ
    q = 101  # –ø—Ä–æ—Å—Ç–µ —á–∏—Å–ª–æ –¥–ª—è –º–æ–¥—É–ª—è
    
    pattern_len = len(pattern)
    text_len = len(text)
    pattern_hash = 0
    text_hash = 0
    h = 1
    positions = []
    
    # –û–±—á–∏—Å–ª—é—î–º–æ h = pow(d, pattern_len-1) % q
    for i in range(pattern_len - 1):
        h = (h * d) % q
    
    # –û–±—á–∏—Å–ª—é—î–º–æ —Ö–µ—à —à–∞–±–ª–æ–Ω—É —Ç–∞ –ø–µ—Ä—à–æ–≥–æ –≤—ñ–∫–Ω–∞ —Ç–µ–∫—Å—Ç—É
    for i in range(pattern_len):
        pattern_hash = (d * pattern_hash + ord(pattern[i])) % q
        text_hash = (d * text_hash + ord(text[i])) % q
    
    # –ö–æ–≤–∑–∞—î–º–æ —à–∞–±–ª–æ–Ω –ø–æ —Ç–µ–∫—Å—Ç—É
    for i in range(text_len - pattern_len + 1):
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ö–µ—à—ñ
        if pattern_hash == text_hash:
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å–∏–º–≤–æ–ª–∏ –æ–¥–∏–Ω –∑–∞ –æ–¥–Ω–∏–º
            if text[i:i + pattern_len] == pattern:
                positions.append(i)
        
        # –û–±—á–∏—Å–ª—é—î–º–æ —Ö–µ—à –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
        if i < text_len - pattern_len:
            text_hash = (d * (text_hash - ord(text[i]) * h) + ord(text[i + pattern_len])) % q
            if text_hash < 0:
                text_hash += q
    
    return positions


def load_text_files():
    """
    –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ç–µ–∫—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –æ–±—Ä–æ–±–∫–æ—é —Ä—ñ–∑–Ω–∏—Ö –∫–æ–¥—É–≤–∞–Ω—å.
    
    Returns:
        tuple: (—Ç–µ–∫—Å—Ç1, —Ç–µ–∫—Å—Ç2)
    """
    def try_read_file(filename):
        """–°–ø—Ä–æ–±—É—î –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ–¥—É–≤–∞–Ω–Ω—è–º–∏."""
        encodings = ['utf-8', 'cp1251', 'latin-1', 'cp866', 'utf-16']
        
        for encoding in encodings:
            try:
                with open(filename, 'r', encoding=encoding) as f:
                    content = f.read()
                    print(f"‚úÖ –§–∞–π–ª '{filename}' –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –∑ –∫–æ–¥—É–≤–∞–Ω–Ω—è–º {encoding}")
                    return content
            except (FileNotFoundError, UnicodeDecodeError):
                continue
        
        # –Ø–∫—â–æ –∂–æ–¥–µ–Ω –≤–∞—Ä—ñ–∞–Ω—Ç –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤
        print(f"‚ö†Ô∏è  –ù–µ –≤–¥–∞–ª–æ—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª '{filename}', –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑—Ä–∞–∑–æ–∫ —Ç–µ–∫—Å—Ç—É")
        return None
    
    # –°–ø—Ä–æ–±—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–µ—Ä—à–∏–π —Ñ–∞–π–ª
    text1 = try_read_file('—Å—Ç–∞—Ç—Ç—è1.txt')
    if text1 is None:
        text1 = """
        –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ —É –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ö –º–æ–≤ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è
        –ó–∞ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö –Ω–∞—É–∫ —Å–∫–ª–∞–ª–æ—Å—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è, —è–∫—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö 
        –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–∞–∫—Ç–∏—á–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å. –ê–ª–≥–æ—Ä–∏—Ç–º–∏ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è 
        –ø–æ–≤—Å—é–¥–Ω–æ: —Ç–æ–≤–∞—Ä–∏ –≤ –º–∞–≥–∞–∑–∏–Ω—ñ —Å–æ—Ä—Ç—É—é—Ç—å –∑–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—é –∞–±–æ —Ç–µ—Ä–º—ñ–Ω—É –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ, 
        –∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∏ ‚Äì –∑–∞ –≤—ñ–¥–¥–∞–ª–µ–Ω—ñ—Å—Ç—é –∞–±–æ —Ä–µ–π—Ç–∏–Ω–≥—É. –•–µ—à-—Ç–∞–±–ª–∏—Ü—ñ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ 
        –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å –ø–∞—Ä–æ–ª—è —Ç–∞ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –π–æ–≥–æ –Ω–∞ —Å–∞–π—Ç—ñ —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ.
        –î–≤—ñ–π–∫–æ–≤–∏–π –ø–æ—à—É–∫ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —à–≤–∏–¥–∫–∏–π —á–∞—Å –ø–æ—à—É–∫—É. –¶–µ–π –≤–∏–¥ –ø–æ—à—É–∫—É 
        –≤–∏–º–∞–≥–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö. –ê–ª–≥–æ—Ä–∏—Ç–º –¥—ñ–ª–∏—Ç—å –≤—Ö—ñ–¥–Ω—É –∫–æ–ª–µ–∫—Ü—ñ—é 
        –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø–æ–ª–æ–≤–∏–Ω–∏, —ñ –∑ –∫–æ–∂–Ω–æ—é —ñ—Ç–µ—Ä–∞—Ü—ñ—î—é –ø–æ—Ä—ñ–≤–Ω—é—î —Ü—ñ–ª—å–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç –∑ –µ–ª–µ–º–µ–Ω—Ç–æ–º —É —Å–µ—Ä–µ–¥–∏–Ω—ñ.
        –ñ–∞–¥—ñ–±–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º ‚Äì –º–µ—Ç–æ–¥ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π–Ω–∏—Ö –∑–∞–¥–∞—á, –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π –Ω–∞ —Ç–æ–º—É, 
        —â–æ –ø—Ä–æ—Ü–µ—Å –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω–Ω—è –º–æ–∂–Ω–∞ —Ä–æ–∑–±–∏—Ç–∏ –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ñ –∫—Ä–æ–∫–∏.
        –õ—ñ–Ω—ñ–π–Ω–∏–π –ø–æ—à—É–∫ ‚Äì –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ—à—É–∫—É, —è–∫–∏–π —Ä—ñ–¥–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ 
        —Å–≤–æ—é –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å. –¶–µ –º–µ—Ç–æ–¥ –ø–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä—É, —ñ –≤—ñ–Ω –ø–æ—Å—Ç—É–ø–∞—î—Ç—å—Å—è —ñ–Ω—à–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º.
        –Ü–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ–π–Ω–∏–π –ø–æ—à—É–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–æ—à—É–∫—É –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ–º—É –º–∞—Å–∏–≤—ñ.
        –ï–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω–∏–π –ø–æ—à—É–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–æ—à—É–∫—É –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —à–ª—è—Ö–æ–º –ø–µ—Ä–µ—Ö–æ–¥—É –≤ 
        –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó. –ñ–∞–¥—ñ–±–Ω—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –≤—ñ–¥—ñ–≥—Ä–∞—é—Ç—å –≤–∞–∂–ª–∏–≤—É —Ä–æ–ª—å —É —Ç–µ–æ—Ä—ñ—ó –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤.
        """ * 10  # –ü–æ–≤—Ç–æ—Ä—é—î–º–æ –¥–ª—è –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É
    
    # –°–ø—Ä–æ–±—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥—Ä—É–≥–∏–π —Ñ–∞–π–ª
    text2 = try_read_file('—Å—Ç–∞—Ç—Ç—è2.txt')
    if text2 is None:
        text2 = """
        –ú–µ—Ç–æ–¥–∏ —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏
        –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ —î –≤–∞–∂–ª–∏–≤–æ—é —Å–∫–ª–∞–¥–æ–≤–æ—é —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂ —Ç–∞ –∑–Ω–∞—á–Ω–∏–º —á–∏–Ω–æ–º 
        –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —Ç–µ, —è–∫–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–ø—Ä–∏–π–º–∞—é—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä. –í–∏–±—ñ—Ä –º–µ—Ç–æ–¥—É 
        –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –º–∞—î –≤–∞–∂–ª–∏–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏.
        –ó–≤'—è–∑–Ω–∏–π —Å–ø–∏—Å–æ–∫ ‚Äì —Ü–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö, —É —è–∫—ñ–π –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –º–∞—î –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π. 
        –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏–π –∑–≤'—è–∑–Ω–∏–π —Å–ø–∏—Å–æ–∫ ‚Äì —Ü–µ –∑–≤'—è–∑–Ω–∏–π —Å–ø–∏—Å–æ–∫, –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç —è–∫–æ–≥–æ –º—ñ—Å—Ç–∏—Ç—å –º–∞—Å–∏–≤ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.
        –•–µ—à-—Ç–∞–±–ª–∏—Ü—è ‚Äì —Ü–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö, —É —è–∫—ñ–π –ø–æ—à—É–∫ –µ–ª–µ–º–µ–Ω—Ç—É –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –π–æ–≥–æ –∫–ª—é—á–∞.
        B-–¥–µ—Ä–µ–≤–æ ‚Äì —Ü–µ –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–µ, —Å–∏–ª—å–Ω–æ —Ä–æ–∑–≥–∞–ª—É–¥–∂–µ–Ω–µ –¥–µ—Ä–µ–≤–æ –ø–æ—à—É–∫—É. B+-–¥–µ—Ä–µ–≤–æ –∑–±–µ—Ä—ñ–≥–∞—î 
        —É—Å—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —É –ª–∏—Å—Ç–∫–æ–≤–∏—Ö –≤—É–∑–ª–∞—Ö —Ç–∞ –º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—É—Å—ñ–¥—ñ–≤.
        –ë—ñ–Ω–∞—Ä–Ω—ñ –¥—ñ–∞–≥—Ä–∞–º–∏ —Ä—ñ—à–µ–Ω—å ‚Äì —Ü–µ –µ–∫–æ–Ω–æ–º–Ω–∞ —Ñ–æ—Ä–º–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –±—É–ª–µ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π.
        –ü—Ä–æ—Ñ—ñ–ª—é–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑–∞–ª–æ, —â–æ 75% —á–∞—Å—É —Ä–æ–±–æ—Ç–∏ —Ç–µ—Å—Ç—É –≤–∞—Ä—ñ–∞–Ω—Ç—É –∑ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏–º —Å–ø–∏—Å–∫–æ–º 
        –∑–∞–π–Ω—è–ª–æ –≥–µ–Ω–µ—Ä—É–≤–∞–Ω–Ω—è –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ —ñ–º—ñ—Ç–∞—Ü—ñ–π–Ω–æ–≥–æ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è.
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ–≥–æ —Å–ø–∏—Å–∫—É –¥—É–∂–µ –ø—Ä–æ—Å—Ç–∞, —Ç–æ–∂ —Ü–µ –¥–∞—Å—Ç—å –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ 
        –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤—É —Ä–æ–±–æ—Ç—É –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω—å.
        """ * 10
    
    return text1, text2


def benchmark_algorithms(text, existing_pattern, fake_pattern, text_name):
    """
    –ü–æ—Ä—ñ–≤–Ω—é—î —à–≤–∏–¥–∫—ñ—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –ø–æ—à—É–∫—É.
    
    Args:
        text (str): –¢–µ–∫—Å—Ç –¥–ª—è –ø–æ—à—É–∫—É
        existing_pattern (str): –ü—ñ–¥—Ä—è–¥–æ–∫, —â–æ —ñ—Å–Ω—É—î –≤ —Ç–µ–∫—Å—Ç—ñ
        fake_pattern (str): –í–∏–≥–∞–¥–∞–Ω–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫
        text_name (str): –ù–∞–∑–≤–∞ —Ç–µ–∫—Å—Ç—É –¥–ª—è –∑–≤—ñ—Ç—É
        
    Returns:
        dict: –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å
    """
    algorithms = {
        'Boyer-Moore': boyer_moore_search,
        'KMP': kmp_search,
        'Rabin-Karp': rabin_karp_search
    }
    
    results = {}
    
    print(f"\nüîç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ {text_name}")
    print("-" * 50)
    print(f"üìä –†–æ–∑–º—ñ—Ä —Ç–µ–∫—Å—Ç—É: {len(text):,} —Å–∏–º–≤–æ–ª—ñ–≤")
    print(f"üéØ –Ü—Å–Ω—É—é—á–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫: '{existing_pattern}' (–¥–æ–≤–∂–∏–Ω–∞: {len(existing_pattern)})")
    print(f"üé≠ –í–∏–≥–∞–¥–∞–Ω–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫: '{fake_pattern}' (–¥–æ–≤–∂–∏–Ω–∞: {len(fake_pattern)})")
    
    for alg_name, alg_func in algorithms.items():
        print(f"\nüî¨ –¢–µ—Å—Ç—É—î–º–æ {alg_name}:")
        
        # –¢–µ—Å—Ç –Ω–∞ —ñ—Å–Ω—É—é—á–æ–º—É –ø—ñ–¥—Ä—è–¥–∫—É
        positions_existing = alg_func(text, existing_pattern)
        time_existing = timeit.timeit(
            lambda: alg_func(text, existing_pattern), 
            number=10
        ) / 10
        
        # –¢–µ—Å—Ç –Ω–∞ –≤–∏–≥–∞–¥–∞–Ω–æ–º—É –ø—ñ–¥—Ä—è–¥–∫—É
        positions_fake = alg_func(text, fake_pattern)
        time_fake = timeit.timeit(
            lambda: alg_func(text, fake_pattern), 
            number=10
        ) / 10
        
        results[alg_name] = {
            'existing_time': time_existing,
            'fake_time': time_fake,
            'existing_count': len(positions_existing),
            'fake_count': len(positions_fake)
        }
        
        print(f"   üìç –Ü—Å–Ω—É—é—á–∏–π: {len(positions_existing)} –∑–±—ñ–≥—ñ–≤, {time_existing:.6f} —Å–µ–∫")
        print(f"   üö´ –í–∏–≥–∞–¥–∞–Ω–∏–π: {len(positions_fake)} –∑–±—ñ–≥—ñ–≤, {time_fake:.6f} —Å–µ–∫")
    
    return results


def analyze_results(results1, results2, text1_name, text2_name):
    """
    –ê–Ω–∞–ª—ñ–∑—É—î —Ç–∞ –≤–∏–≤–æ–¥–∏—Ç—å –ø—ñ–¥—Å—É–º–∫–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏.
    
    Args:
        results1 (dict): –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è –ø–µ—Ä—à–æ–≥–æ —Ç–µ–∫—Å—Ç—É
        results2 (dict): –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ —Ç–µ–∫—Å—Ç—É
        text1_name (str): –ù–∞–∑–≤–∞ –ø–µ—Ä—à–æ–≥–æ —Ç–µ–∫—Å—Ç—É
        text2_name (str): –ù–∞–∑–≤–∞ –¥—Ä—É–≥–æ–≥–æ —Ç–µ–∫—Å—Ç—É
    """
    print(f"\n" + "="*70)
    print("üìä –ü–Ü–î–°–£–ú–ö–û–í–ò–ô –ê–ù–ê–õ–Ü–ó –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í")
    print("="*70)
    
    algorithms = list(results1.keys())
    
    # –ê–Ω–∞–ª—ñ–∑ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É –æ–∫—Ä–µ–º–æ
    for results, text_name in [(results1, text1_name), (results2, text2_name)]:
        print(f"\nüî∏ {text_name}:")
        
        # –ù–∞–π—à–≤–∏–¥—à–∏–π –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –ø—ñ–¥—Ä—è–¥–∫—ñ–≤
        fastest_existing = min(algorithms, key=lambda x: results[x]['existing_time'])
        print(f"   üèÜ –ù–∞–π—à–≤–∏–¥—à–∏–π (—ñ—Å–Ω—É—é—á–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫): {fastest_existing}")
        print(f"      –ß–∞—Å: {results[fastest_existing]['existing_time']:.6f} —Å–µ–∫")
        
        # –ù–∞–π—à–≤–∏–¥—à–∏–π –¥–ª—è –≤–∏–≥–∞–¥–∞–Ω–∏—Ö –ø—ñ–¥—Ä—è–¥–∫—ñ–≤
        fastest_fake = min(algorithms, key=lambda x: results[x]['fake_time'])
        print(f"   üèÜ –ù–∞–π—à–≤–∏–¥—à–∏–π (–≤–∏–≥–∞–¥–∞–Ω–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫): {fastest_fake}")
        print(f"      –ß–∞—Å: {results[fastest_fake]['fake_time']:.6f} —Å–µ–∫")
        
        # –î–µ—Ç–∞–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è
        print(f"   üìã –î–µ—Ç–∞–ª—å–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:")
        print(f"      {'–ê–ª–≥–æ—Ä–∏—Ç–º':<15} {'–Ü—Å–Ω—É—é—á–∏–π (—Å–µ–∫)':<15} {'–í–∏–≥–∞–¥–∞–Ω–∏–π (—Å–µ–∫)':<15}")
        print(f"      {'-'*45}")
        for alg in algorithms:
            existing_time = results[alg]['existing_time']
            fake_time = results[alg]['fake_time']
            print(f"      {alg:<15} {existing_time:<15.6f} {fake_time:<15.6f}")
    
    # –ó–∞–≥–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑
    print(f"\nüî∏ –ó–∞–≥–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑:")
    
    # –°–µ—Ä–µ–¥–Ω—ñ —á–∞—Å–∏ –¥–ª—è –≤—Å—ñ—Ö —Ç–µ—Å—Ç—ñ–≤
    avg_times = {}
    for alg in algorithms:
        total_time = (results1[alg]['existing_time'] + results1[alg]['fake_time'] + 
                     results2[alg]['existing_time'] + results2[alg]['fake_time'])
        avg_times[alg] = total_time / 4
    
    fastest_overall = min(avg_times.keys(), key=lambda x: avg_times[x])
    print(f"   üèÜ –ù–∞–π—à–≤–∏–¥—à–∏–π –∑–∞–≥–∞–ª–æ–º: {fastest_overall}")
    print(f"   üìä –°–µ—Ä–µ–¥–Ω—ñ —á–∞—Å–∏:")
    for alg in sorted(avg_times.keys(), key=lambda x: avg_times[x]):
        print(f"      {alg}: {avg_times[alg]:.6f} —Å–µ–∫")
    
    # –í—ñ–¥–Ω–æ—Å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å
    print(f"\n   ‚ö° –°–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ (–≤—ñ–¥–Ω–æ—Å–Ω–æ –Ω–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à–æ–≥–æ):")
    slowest_time = max(avg_times.values())
    for alg in sorted(avg_times.keys(), key=lambda x: avg_times[x]):
        speedup = slowest_time / avg_times[alg]
        print(f"      {alg}: {speedup:.2f}x —à–≤–∏–¥—à–µ")


def main():
    """
    –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø—É—Å–∫—É –≤—Å—ñ—Ö —Ç–µ—Å—Ç—ñ–≤.
    """
    print("üîç –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –ø–æ—à—É–∫—É –ø—ñ–¥—Ä—è–¥–∫—ñ–≤")
    print("="*50)
    print("üìã –ê–ª–≥–æ—Ä–∏—Ç–º–∏: Boyer-Moore, KMP, Rabin-Karp")
    print("üìÑ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –¥–≤–æ—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö —Ñ–∞–π–ª–∞—Ö")
    
    # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–µ–∫—Å—Ç–∏
    text1, text2 = load_text_files()
    
    # –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø—ñ–¥—Ä—è–¥–∫–∏ –¥–ª—è –ø–æ—à—É–∫—É
    # –Ü—Å–Ω—É—é—á—ñ –ø—ñ–¥—Ä—è–¥–∫–∏ (–∑–Ω–∞—î–º–æ, —â–æ –≤–æ–Ω–∏ —î –≤ —Ç–µ–∫—Å—Ç–∞—Ö)
    existing_patterns = {
        'text1': '–∞–ª–≥–æ—Ä–∏—Ç–º',
        'text2': '—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö'
    }
    
    # –í–∏–≥–∞–¥–∞–Ω—ñ –ø—ñ–¥—Ä—è–¥–∫–∏ (–π–º–æ–≤—ñ—Ä–Ω–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ)
    fake_patterns = {
        'text1': '–∫–≤–∞–Ω—Ç–æ–≤–∏–π –∫–æ–º–ø\'—é—Ç–µ—Ä',
        'text2': '–Ω–µ–π—Ä–æ–Ω–Ω–∞ –º–µ—Ä–µ–∂–∞ blockchain'
    }
    
    # –¢–µ—Å—Ç—É—î–º–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∏
    results1 = benchmark_algorithms(
        text1, 
        existing_patterns['text1'], 
        fake_patterns['text1'], 
        "–°—Ç–∞—Ç—Ç—è 1 (–ê–ª–≥–æ—Ä–∏—Ç–º–∏ –≤ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ö)"
    )
    
    results2 = benchmark_algorithms(
        text2, 
        existing_patterns['text2'], 
        fake_patterns['text2'], 
        "–°—Ç–∞—Ç—Ç—è 2 (–°—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –¥–ª—è –ë–î)"
    )
    
    # –ê–Ω–∞–ª—ñ–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
    analyze_results(
        results1, results2, 
        "–°—Ç–∞—Ç—Ç—è 1", "–°—Ç–∞—Ç—Ç—è 2"
    )
    
    # –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ç–µ—Å—Ç–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –¥–æ–≤–∂–∏–Ω–∞–º–∏ –ø—ñ–¥—Ä—è–¥–∫—ñ–≤
    print(f"\n" + "="*70)
    print("üß™ –î–û–î–ê–¢–ö–û–í–Ü –¢–ï–°–¢–ò –ó –†–Ü–ó–ù–ò–ú–ò –î–û–í–ñ–ò–ù–ê–ú–ò –ü–Ü–î–†–Ø–î–ö–Ü–í")
    print("="*70)
    
    test_patterns = [
        ('–∞', '–∫–æ—Ä–æ—Ç–∫–∏–π —Å–∏–º–≤–æ–ª'),
        ('—Ç–∞', '–∫–æ—Ä–æ—Ç–∫–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫'),
        ('–∞–ª–≥–æ—Ä–∏—Ç–º', '—Å–µ—Ä–µ–¥–Ω—ñ–π –ø—ñ–¥—Ä—è–¥–æ–∫'),
        ('—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö', '–¥–æ–≤–≥–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫'),
        ('xyz123nonexistent', '–Ω–µ—ñ—Å–Ω—É—é—á–∏–π –ø—ñ–¥—Ä—è–¥–æ–∫')
    ]
    
    print(f"üìä –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –ø–µ—Ä—à–æ–º—É —Ç–µ–∫—Å—Ç—ñ:")
    for pattern, description in test_patterns:
        print(f"\nüî∏ {description} ('{pattern}'):")
        
        times = {}
        for alg_name, alg_func in [('Boyer-Moore', boyer_moore_search), 
                                  ('KMP', kmp_search), 
                                  ('Rabin-Karp', rabin_karp_search)]:
            time_taken = timeit.timeit(lambda: alg_func(text1, pattern), number=5) / 5
            times[alg_name] = time_taken
            count = len(alg_func(text1, pattern))
            print(f"   {alg_name}: {time_taken:.6f} —Å–µ–∫ ({count} –∑–±—ñ–≥—ñ–≤)")
        
        fastest = min(times.keys(), key=lambda x: times[x])
        print(f"   üèÜ –ù–∞–π—à–≤–∏–¥—à–∏–π: {fastest}")


if __name__ == "__main__":
    main()
    
    print("\n‚úÖ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
    print("\nüí° –í–∏—Å–Ω–æ–≤–∫–∏:")
    print("   ‚Ä¢ Boyer-Moore –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –¥–ª—è –¥–æ–≤–≥–∏—Ö –ø—ñ–¥—Ä—è–¥–∫—ñ–≤ —Ç–∞ –≤–µ–ª–∏–∫–∏—Ö –∞–ª—Ñ–∞–≤—ñ—Ç—ñ–≤")
    print("   ‚Ä¢ KMP –ø–æ–∫–∞–∑—É—î —Å—Ç–∞–±—ñ–ª—å–Ω—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è –≤—Å—ñ—Ö –≤–∏–ø–∞–¥–∫—ñ–≤")
    print("   ‚Ä¢ Rabin-Karp –¥–æ–±—Ä–µ –ø—Ä–∞—Ü—é—î –∑ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –ø—ñ–¥—Ä—è–¥–∫–∞–º–∏")
    print("   ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –º–æ–∂—É—Ç—å –∑–∞–ª–µ–∂–∞—Ç–∏ –≤—ñ–¥ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Ç–µ–∫—Å—Ç—É —Ç–∞ –ø—ñ–¥—Ä—è–¥–∫–∞")
